<?php  function acf_pro_get_view( $view_name = '', $args = array() ) { $path = acf_get_path("pro/admin/views/{$view_name}.php"); if( file_exists($path) ) { include( $path ); } } function acf_pro_get_remote_url( $action = '', $args = array() ) { $args['a'] = $action; $args['p'] = 'pro'; $url = "http://connect.advancedcustomfields.com/index.php?" . build_query($args); return $url; } function acf_pro_get_remote_response( $action = '', $post = array() ) { $url = acf_pro_get_remote_url( $action ); $request = wp_remote_post( $url, array( 'body' => $post )); if( !is_wp_error($request) || wp_remote_retrieve_response_code($request) === 200) { return $request['body']; } return 0; } function acf_pro_is_update_available() { $info = acf_pro_get_remote_info(); $version = acf_get_setting('version'); if( empty($info['version']) ) { return false; } if( version_compare($info['version'], $version, '<=') ) { return false; } return true; } function acf_pro_get_remote_info() { if( !empty($_GET['force-check']) ) { if( empty($_GET['acf-ignore-force-check']) ) { delete_transient( 'acf_pro_get_remote_info' ); } $_GET['acf-ignore-force-check'] = true; } $transient = get_transient( 'acf_pro_get_remote_info' ); if( $transient !== false ) { return $transient; } $info = acf_pro_get_remote_response('get-info'); $timeout = 12 * HOUR_IN_SECONDS; if( !empty($info) ) { $info = json_decode($info, true); } else { $info = 0; $timeout = 2 * HOUR_IN_SECONDS; } set_transient('acf_pro_get_remote_info', $info, $timeout ); return $info; } function acf_pro_is_license_active() { $data = acf_pro_get_license( true ); $url = home_url(); if( !empty($data['url']) && !empty($data['key']) && $data['url'] == $url ) { return true; } return false; } function acf_pro_get_license( $all = false ) { $data = get_option('acf_pro_license'); $data = base64_decode($data); if( is_serialized( $data ) ) { $data = maybe_unserialize($data); if( !$all ) { $data = $data['key']; } return $data; } return false; } function acf_pro_update_license( $license ) { $save = array( 'key' => $license, 'url' => home_url() ); $save = maybe_serialize($save); $save = base64_encode($save); return update_option('acf_pro_license', $save); } ?>

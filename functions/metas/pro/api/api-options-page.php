<?php  function acf_get_valid_options_page( $page = '' ) { if( empty($page) ) { $page = array( 'page_title' => __('Options','acf'), 'menu_title' => __('Options','acf'), 'menu_slug' => 'acf-options', ); } elseif( is_string($page) ) { $page_title = $page; $page = array( 'page_title' => $page_title, 'menu_title' => $page_title ); } $page = acf_parse_args($page, array( 'page_title' => '', 'menu_title' => '', 'menu_slug' => '', 'capability' => 'edit_posts', 'parent_slug' => '', 'position' => false, 'icon_url' => false, 'redirect' => true, 'post_id' => 'options', 'autoload' => false )); $migrate = array( 'title' => 'page_title', 'menu' => 'menu_title', 'slug' => 'menu_slug', 'parent' => 'parent_slug' ); foreach( $migrate as $old => $new ) { if( !empty($page[ $old ]) ) { $page[ $new ] = acf_extract_var( $page, $old ); } } if( empty($page['menu_title']) ) { $page['menu_title'] = $page['page_title']; } if( empty($page['menu_slug']) ) { $page['menu_slug'] = 'acf-options-' . sanitize_title( $page['menu_title'] ); } return $page; } function acf_get_options_page( $slug ) { if( empty($GLOBALS['acf_options_pages'][ $slug ]) ) { return false; } $page = $GLOBALS['acf_options_pages'][ $slug ]; $page = apply_filters('acf/get_options_page', $page, $slug); return $page; } function acf_get_options_pages() { global $_wp_last_utility_menu; if( empty($GLOBALS['acf_options_pages']) ) { return false; } $pages = array(); $redirects = array(); $slugs = array_keys($GLOBALS['acf_options_pages']); foreach( $slugs as $slug ) { $pages[] = acf_get_options_page( $slug ); } foreach( $pages as $i => $page ) { if( !empty($page['parent_slug']) ) { continue; } if( !$page['position']) { $_wp_last_utility_menu++; $pages[ $i ]['position'] = $_wp_last_utility_menu; } if( empty($page['redirect']) ) { continue; } $parent = $page['menu_slug']; $child = ''; foreach( $pages as $j => $sub_page ) { if( $sub_page['parent_slug'] !== $parent ) { continue; } if( empty($child) ) { $child = $sub_page['menu_slug']; } $pages[ $j ]['parent_slug'] = $child; } if( $child ) { $pages[ $i ]['menu_slug'] = $child; } } return $pages; } function acf_update_options_page( $data ) { if( empty($data['menu_slug']) ) { return false; } $slug = $data['menu_slug']; if( empty($GLOBALS['acf_options_pages'][ $slug ]) ) { return false; } $page = $GLOBALS['acf_options_pages'][ $slug ]; $page = array_merge($page, $data); $GLOBALS['acf_options_pages'][ $slug ] = $page; return $page; } if( ! function_exists('acf_add_options_page') ): function acf_add_options_page( $page = '' ) { $page = acf_get_valid_options_page( $page ); if( empty($GLOBALS['acf_options_pages']) ) { $GLOBALS['acf_options_pages'] = array(); } if( acf_get_options_page($page['menu_slug']) ) { return acf_update_options_page( $page ); } $GLOBALS['acf_options_pages'][ $page['menu_slug'] ] = $page; return $page; } endif; if( ! function_exists('acf_add_options_sub_page') ): function acf_add_options_sub_page( $page = '' ) { $page = acf_get_valid_options_page( $page ); if( !$page['parent_slug'] ) { $page['parent_slug'] = 'acf-options'; } if( $page['parent_slug'] === 'acf-options' ) { if( !acf_get_options_page('acf-options') ) { acf_add_options_page(); } } return acf_add_options_page( $page ); } endif; if( ! function_exists('acf_set_options_page_title') ): function acf_set_options_page_title( $title = 'Options' ) { acf_update_options_page(array( 'menu_slug' => 'acf-options', 'page_title' => $title, 'menu_title' => $title )); } endif; if( ! function_exists('acf_set_options_page_menu') ): function acf_set_options_page_menu( $title = 'Options' ) { acf_update_options_page(array( 'menu_slug' => 'acf-options', 'menu_title' => $title )); } endif; if( ! function_exists('acf_set_options_page_capability') ): function acf_set_options_page_capability( $capability = 'edit_posts' ) { acf_update_options_page(array( 'menu_slug' => 'acf-options', 'capability' => $capability )); } endif; if( ! function_exists('register_options_page') ): function register_options_page( $title = false ) { acf_add_options_sub_page( $title ); } endif; ?>

<?php  class acf_pro_connect { function __construct() { add_filter('plugins_api', array($this, 'inject_info'), 20, 3); add_filter('site_transient_update_plugins', array($this, 'inject_update')); add_action('in_plugin_update_message-' . acf_get_setting('basename'), array($this, 'in_plugin_update_message'), 10, 2 ); } function inject_info( $res, $action = null, $args = null ) { $slug = acf_get_setting('slug'); if( isset($args->slug) && $args->slug == $slug ) { $info = acf_pro_get_remote_info(); $sections = acf_extract_vars($info, array( 'description', 'installation', 'changelog', 'upgrade_notice', )); $obj = new stdClass(); foreach( $info as $k => $v ) { $obj->$k = $v; } $obj->sections = $sections; return $obj; } return $res; } function inject_update( $transient ) { if( !is_admin() ) { return $transient; } if( !acf_pro_is_update_available() ) { return $transient; } $info = acf_pro_get_remote_info(); $basename = acf_get_setting('basename'); $slug = acf_get_setting('slug'); $obj = new stdClass(); $obj->slug = $slug; $obj->new_version = $info['version']; $obj->url = $info['homepage']; $obj->package = ''; if( acf_pro_is_license_active() ) { $obj->package = acf_pro_get_remote_url( 'download', array( 'k' => acf_pro_get_license() ) ); } $transient->response[ $basename ] = $obj; return $transient; } function in_plugin_update_message( $plugin_data, $r ) { if( acf_pro_is_license_active() ) { return; } $m = __('To enable updates, please enter your license key on the <a href="%s">Updates</a> page. If you don\'t have a licence key, please see <a href="%s">details & pricing</a>', 'acf'); echo '<br />' . sprintf( $m, admin_url('edit.php?post_type=acf-field-group&page=acf-settings-updates'), 'http://www.advancedcustomfields.com/pro'); } } new acf_pro_connect(); ?>
